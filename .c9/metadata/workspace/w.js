{"changed":true,"filter":false,"title":"w.js","tooltip":"/w.js","value":"","undoManager":{"mark":60,"position":61,"stack":[[{"start":{"row":0,"column":0},"end":{"row":6,"column":2},"action":"insert","lines":["var weatherData = {","  city: document.querySelector(\"#city\"),","  weather: document.querySelector(\"#weather\"),","  temperature: document.querySelector(\"#temperature\"),","  temperatureValue: 0,","  units: \"°C\"","};"],"id":1}],[{"start":{"row":6,"column":2},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":2}],[{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"insert","lines":["",""],"id":3}],[{"start":{"row":8,"column":0},"end":{"row":19,"column":1},"action":"insert","lines":["function switchUnits(){","  if (weatherData.units == \"°C\"){","    weatherData.temperatureValue = roundTemperature(weatherData.temperatureValue * 9/5 + 32);","    weatherData.units = \"°F\";","  }","  else{","    weatherData.temperatureValue = roundTemperature((weatherData.temperatureValue -  32) * 5/9);","    weatherData.units = \"°C\";","  }","","  weatherData.temperature.innerHTML = weatherData.temperatureValue + weatherData.units + \", \";      ","}"],"id":4}],[{"start":{"row":19,"column":1},"end":{"row":20,"column":0},"action":"insert","lines":["",""],"id":5}],[{"start":{"row":20,"column":0},"end":{"row":21,"column":0},"action":"insert","lines":["",""],"id":6}],[{"start":{"row":21,"column":0},"end":{"row":34,"column":1},"action":"insert","lines":["function getLocationAndWeather(){","  if (window.XMLHttpRequest){","    var xhr = new XMLHttpRequest();","    ","    xhr.addEventListener(\"load\", function() {}, false);","    xhr.addEventListener(\"error\", function(){}, false);","    ","    xhr.open(\"GET\", \"<URL>\", true);","    xhr.send();","  }","  else{","    alert(\"Unable to fetch the location and weather data.\");","  }     ","}"],"id":7}],[{"start":{"row":34,"column":1},"end":{"row":35,"column":0},"action":"insert","lines":["",""],"id":8}],[{"start":{"row":35,"column":0},"end":{"row":36,"column":0},"action":"insert","lines":["",""],"id":9}],[{"start":{"row":36,"column":0},"end":{"row":71,"column":1},"action":"insert","lines":["unction getLocationAndWeather(){","  if (window.XMLHttpRequest){","    var xhr = new XMLHttpRequest();","    xhr.addEventListener(\"load\", function() {","      var response = JSON.parse(xhr.responseText);","","      console.log(response);","      var position = {","        latitude: response.latitude,","        longitude: response.longitude","      };","      var cityName = response.city;","","      var weatherSimpleDescription = response.weather.simple;","      var weatherDescription = response.weather.description;","      var weatherTemperature = roundTemperature(response.weather.temperature);","","      weatherData.temperatureValue = weatherTemperature;","","      loadBackground(position.latitude, position.longitude, weatherSimpleDescription);","      weatherData.city.innerHTML = cityName;","      weatherData.weather.innerHTML =  \", \" + weatherDescription;","      weatherData.temperature.innerHTML = weatherTemperature + weatherData.units;","    }, false);","","    xhr.addEventListener(\"error\", function(err){","      alert(\"Could not complete the request\");","    }, false);","","    xhr.open(\"GET\", \"https://fourtonfish.com/tutorials/weather-web-app/getlocationandweather.php?owapikey=YOUROPENWEATHERMAPKEY&units=metric\", true);","    xhr.send();","  }","  else{","    alert(\"Unable to fetch the location and weather data.\");","  }           ","}"],"id":10}],[{"start":{"row":36,"column":0},"end":{"row":36,"column":1},"action":"insert","lines":["f"],"id":11}],[{"start":{"row":71,"column":1},"end":{"row":72,"column":0},"action":"insert","lines":["",""],"id":12}],[{"start":{"row":72,"column":0},"end":{"row":73,"column":0},"action":"insert","lines":["",""],"id":13}],[{"start":{"row":73,"column":0},"end":{"row":79,"column":1},"action":"insert","lines":["function loadBackground(lat, lon, weatherTag) {","  var script_element = document.createElement('script');","","  script_element.src = \"https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=YOURFLICKRAPIKEY&lat=\" + lat + \"&lon=\" + lon + \"&accuracy=1&tags=\" + weatherTag + \"&sort=relevance&extras=url_l&format=json\";","","  document.getElementsByTagName('head')[0].appendChild(script_element);","}"],"id":14}],[{"start":{"row":79,"column":1},"end":{"row":80,"column":0},"action":"insert","lines":["",""],"id":15}],[{"start":{"row":80,"column":0},"end":{"row":81,"column":0},"action":"insert","lines":["",""],"id":16}],[{"start":{"row":81,"column":0},"end":{"row":101,"column":1},"action":"insert","lines":["function jsonFlickrApi(data){","  if (data.photos.pages > 0){","    // If there are pictures for our weather and location, we will show one of them.","  }","  else{","    // Otherwise let's load a generic background.","  }","}","Flickr also gives us some tricks, for example you can directly build URLs without having to make extra API calls. And that's what we are going to do here to get the URL for our background image and also a link to the page with the original image.","","function jsonFlickrApi(data){","  if (data.photos.pages > 0){","    var photo = data.photos.photo[0];","    document.querySelector(\"body\").style.backgroundImage = \"url('\" + photo.url_l + \"')\";","    document.querySelector(\"#image-source\").setAttribute(\"href\", \"http://www.flickr.com/photos/\" + photo.owner + \"/\" + photo.id);","  }","  else{","    document.querySelector(\"body\").style.backgroundImage = \"url('https://fourtonfish.com/tutorials/weather-web-app/images/default.jpg')\";","    document.querySelector(\"#image-source\").setAttribute(\"href\", \"https://www.flickr.com/photos/superfamous/310185523/sizes/o/\");","  }","}"],"id":19}],[{"start":{"row":89,"column":0},"end":{"row":90,"column":0},"action":"remove","lines":["Flickr also gives us some tricks, for example you can directly build URLs without having to make extra API calls. And that's what we are going to do here to get the URL for our background image and also a link to the page with the original image.",""],"id":20}],[{"start":{"row":100,"column":1},"end":{"row":101,"column":0},"action":"insert","lines":["",""],"id":21}],[{"start":{"row":101,"column":0},"end":{"row":102,"column":0},"action":"insert","lines":["",""],"id":22}],[{"start":{"row":102,"column":0},"end":{"row":102,"column":24},"action":"insert","lines":["getLocationAndWeather();"],"id":23}],[{"start":{"row":65,"column":126},"end":{"row":65,"column":127},"action":"remove","lines":["Y"],"id":24}],[{"start":{"row":65,"column":125},"end":{"row":65,"column":126},"action":"remove","lines":["E"],"id":25}],[{"start":{"row":65,"column":124},"end":{"row":65,"column":125},"action":"remove","lines":["K"],"id":26}],[{"start":{"row":65,"column":123},"end":{"row":65,"column":124},"action":"remove","lines":["P"],"id":27}],[{"start":{"row":65,"column":122},"end":{"row":65,"column":123},"action":"remove","lines":["A"],"id":28}],[{"start":{"row":65,"column":121},"end":{"row":65,"column":122},"action":"remove","lines":["M"],"id":29}],[{"start":{"row":65,"column":120},"end":{"row":65,"column":121},"action":"remove","lines":["R"],"id":30}],[{"start":{"row":65,"column":119},"end":{"row":65,"column":120},"action":"remove","lines":["E"],"id":31}],[{"start":{"row":65,"column":118},"end":{"row":65,"column":119},"action":"remove","lines":["H"],"id":32}],[{"start":{"row":65,"column":117},"end":{"row":65,"column":118},"action":"remove","lines":["T"],"id":33}],[{"start":{"row":65,"column":116},"end":{"row":65,"column":117},"action":"remove","lines":["A"],"id":34}],[{"start":{"row":65,"column":115},"end":{"row":65,"column":116},"action":"remove","lines":["E"],"id":35}],[{"start":{"row":65,"column":114},"end":{"row":65,"column":115},"action":"remove","lines":["W"],"id":36}],[{"start":{"row":65,"column":113},"end":{"row":65,"column":114},"action":"remove","lines":["N"],"id":37}],[{"start":{"row":65,"column":112},"end":{"row":65,"column":113},"action":"remove","lines":["E"],"id":38}],[{"start":{"row":65,"column":111},"end":{"row":65,"column":112},"action":"remove","lines":["P"],"id":39}],[{"start":{"row":65,"column":110},"end":{"row":65,"column":111},"action":"remove","lines":["O"],"id":40}],[{"start":{"row":65,"column":109},"end":{"row":65,"column":110},"action":"remove","lines":["R"],"id":41}],[{"start":{"row":65,"column":108},"end":{"row":65,"column":109},"action":"remove","lines":["U"],"id":42}],[{"start":{"row":65,"column":107},"end":{"row":65,"column":108},"action":"remove","lines":["O"],"id":43}],[{"start":{"row":65,"column":106},"end":{"row":65,"column":107},"action":"remove","lines":["Y"],"id":44}],[{"start":{"row":65,"column":106},"end":{"row":66,"column":0},"action":"insert","lines":["21f4b31bf6c6e5093714c658b5a86ed7",""],"id":45}],[{"start":{"row":65,"column":138},"end":{"row":66,"column":0},"action":"remove","lines":["",""],"id":46}],[{"start":{"row":76,"column":113},"end":{"row":76,"column":114},"action":"remove","lines":["Y"],"id":47}],[{"start":{"row":76,"column":112},"end":{"row":76,"column":113},"action":"remove","lines":["E"],"id":48}],[{"start":{"row":76,"column":111},"end":{"row":76,"column":112},"action":"remove","lines":["K"],"id":49}],[{"start":{"row":76,"column":110},"end":{"row":76,"column":111},"action":"remove","lines":["I"],"id":50}],[{"start":{"row":76,"column":109},"end":{"row":76,"column":110},"action":"remove","lines":["P"],"id":51}],[{"start":{"row":76,"column":108},"end":{"row":76,"column":109},"action":"remove","lines":["A"],"id":52}],[{"start":{"row":76,"column":107},"end":{"row":76,"column":108},"action":"remove","lines":["R"],"id":53}],[{"start":{"row":76,"column":106},"end":{"row":76,"column":107},"action":"remove","lines":["K"],"id":54}],[{"start":{"row":76,"column":105},"end":{"row":76,"column":106},"action":"remove","lines":["C"],"id":55}],[{"start":{"row":76,"column":104},"end":{"row":76,"column":105},"action":"remove","lines":["I"],"id":56}],[{"start":{"row":76,"column":103},"end":{"row":76,"column":104},"action":"remove","lines":["L"],"id":57}],[{"start":{"row":76,"column":102},"end":{"row":76,"column":103},"action":"remove","lines":["F"],"id":58}],[{"start":{"row":76,"column":101},"end":{"row":76,"column":102},"action":"remove","lines":["R"],"id":59}],[{"start":{"row":76,"column":100},"end":{"row":76,"column":101},"action":"remove","lines":["U"],"id":60}],[{"start":{"row":76,"column":99},"end":{"row":76,"column":100},"action":"remove","lines":["O"],"id":61}],[{"start":{"row":76,"column":98},"end":{"row":76,"column":99},"action":"remove","lines":["Y"],"id":62}],[{"start":{"row":76,"column":98},"end":{"row":76,"column":130},"action":"insert","lines":["715813302e0bd4daf6d6f451d6309900"],"id":63}],[{"start":{"row":0,"column":0},"end":{"row":102,"column":24},"action":"remove","lines":["var weatherData = {","  city: document.querySelector(\"#city\"),","  weather: document.querySelector(\"#weather\"),","  temperature: document.querySelector(\"#temperature\"),","  temperatureValue: 0,","  units: \"°C\"","};","","function switchUnits(){","  if (weatherData.units == \"°C\"){","    weatherData.temperatureValue = roundTemperature(weatherData.temperatureValue * 9/5 + 32);","    weatherData.units = \"°F\";","  }","  else{","    weatherData.temperatureValue = roundTemperature((weatherData.temperatureValue -  32) * 5/9);","    weatherData.units = \"°C\";","  }","","  weatherData.temperature.innerHTML = weatherData.temperatureValue + weatherData.units + \", \";      ","}","","function getLocationAndWeather(){","  if (window.XMLHttpRequest){","    var xhr = new XMLHttpRequest();","    ","    xhr.addEventListener(\"load\", function() {}, false);","    xhr.addEventListener(\"error\", function(){}, false);","    ","    xhr.open(\"GET\", \"<URL>\", true);","    xhr.send();","  }","  else{","    alert(\"Unable to fetch the location and weather data.\");","  }     ","}","","function getLocationAndWeather(){","  if (window.XMLHttpRequest){","    var xhr = new XMLHttpRequest();","    xhr.addEventListener(\"load\", function() {","      var response = JSON.parse(xhr.responseText);","","      console.log(response);","      var position = {","        latitude: response.latitude,","        longitude: response.longitude","      };","      var cityName = response.city;","","      var weatherSimpleDescription = response.weather.simple;","      var weatherDescription = response.weather.description;","      var weatherTemperature = roundTemperature(response.weather.temperature);","","      weatherData.temperatureValue = weatherTemperature;","","      loadBackground(position.latitude, position.longitude, weatherSimpleDescription);","      weatherData.city.innerHTML = cityName;","      weatherData.weather.innerHTML =  \", \" + weatherDescription;","      weatherData.temperature.innerHTML = weatherTemperature + weatherData.units;","    }, false);","","    xhr.addEventListener(\"error\", function(err){","      alert(\"Could not complete the request\");","    }, false);","","    xhr.open(\"GET\", \"https://fourtonfish.com/tutorials/weather-web-app/getlocationandweather.php?owapikey=21f4b31bf6c6e5093714c658b5a86ed7&units=metric\", true);","    xhr.send();","  }","  else{","    alert(\"Unable to fetch the location and weather data.\");","  }           ","}","","function loadBackground(lat, lon, weatherTag) {","  var script_element = document.createElement('script');","","  script_element.src = \"https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=715813302e0bd4daf6d6f451d6309900&lat=\" + lat + \"&lon=\" + lon + \"&accuracy=1&tags=\" + weatherTag + \"&sort=relevance&extras=url_l&format=json\";","","  document.getElementsByTagName('head')[0].appendChild(script_element);","}","","function jsonFlickrApi(data){","  if (data.photos.pages > 0){","    // If there are pictures for our weather and location, we will show one of them.","  }","  else{","    // Otherwise let's load a generic background.","  }","}","","function jsonFlickrApi(data){","  if (data.photos.pages > 0){","    var photo = data.photos.photo[0];","    document.querySelector(\"body\").style.backgroundImage = \"url('\" + photo.url_l + \"')\";","    document.querySelector(\"#image-source\").setAttribute(\"href\", \"http://www.flickr.com/photos/\" + photo.owner + \"/\" + photo.id);","  }","  else{","    document.querySelector(\"body\").style.backgroundImage = \"url('https://fourtonfish.com/tutorials/weather-web-app/images/default.jpg')\";","    document.querySelector(\"#image-source\").setAttribute(\"href\", \"https://www.flickr.com/photos/superfamous/310185523/sizes/o/\");","  }","}","","getLocationAndWeather();"],"id":64}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1474805969459}